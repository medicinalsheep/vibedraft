<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vibedraft</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@600&display=swap');
        * { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .tail-container { font-family: 'Inter', system-ui, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1a1f3a 100%); }
        .logo-font { font-family: 'Space Grotesk', sans-serif; letter-spacing: -1px; }
        .viewer-svg { background: #fafbfc; box-shadow: 0 20px 40px rgba(0,0,0,0.4); border-radius: 12px; border: 1px solid #e2e8f0; max-height: 78vh; }
        .title-block { background: linear-gradient(to bottom, #f8fafc, #f0f4f8); border-radius: 8px; border: 1px solid #cbd5e1; font-size: 11px; line-height: 1.05; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .tab-active { border-bottom: 2px solid #60a5fa; color: #60a5fa; font-weight: 600; }
        .error-badge { background: #fee2e2; border: 1px solid #fecaca; color: #991b1b; border-radius: 6px; }
        .success-badge { background: #dcfce7; border: 1px solid #bbf7d0; color: #166534; border-radius: 6px; }
        .constraint-item { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid #334155; border-radius: 8px; padding: 1rem; margin-bottom: 0.75rem; }
        .template-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 0.75rem; }
        .template-button { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); border: 1px solid #475569; border-radius: 8px; padding: 1rem; cursor: pointer; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); text-align: center; }
        .template-button:hover { background: linear-gradient(135deg, #334155 0%, #475569 100%); border-color: #60a5fa; transform: translateY(-2px); box-shadow: 0 8px 16px rgba(96, 165, 250, 0.2); }
        input, textarea { transition: all 0.2s ease; }
        input:focus, textarea:focus { box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1); }
    </style>
</head>
<body class="tail-container text-slate-100 overflow-hidden h-screen flex flex-col">
    <nav class="bg-slate-900/50 backdrop-blur border-b border-slate-700/50 px-8 py-4 flex items-center justify-between">
        <div class="flex items-center gap-x-12">
            <div class="flex items-center gap-x-4">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center text-white font-bold logo-font text-lg shadow-lg">VD</div>
                <div>
                    <h1 class="logo-font text-3xl font-bold tracking-tight text-white">vibedraft</h1>
                    <span class="text-xs font-medium text-cyan-400">v0.1</span>
                </div>
            </div>
            <div class="flex gap-x-8 text-sm font-medium">
                <button onclick="switchTab(0)" id="tab-0" class="tab-active px-4 py-2 transition-colors duration-200 text-slate-300 hover:text-white">VIEWER</button>
                <button onclick="switchTab(1)" id="tab-1" class="px-4 py-2 transition-colors duration-200 text-slate-400 hover:text-white">CODE</button>
                <button onclick="switchTab(2)" id="tab-2" class="px-4 py-2 transition-colors duration-200 text-slate-400 hover:text-white">3D</button>
                <button onclick="switchTab(3)" id="tab-3" class="px-4 py-2 transition-colors duration-200 text-slate-400 hover:text-white">RULES</button>
            </div>
        </div>
        <div class="flex items-center gap-x-3">
            <button onclick="newDrawing()" class="flex items-center gap-x-2 px-4 py-2 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 transition-colors duration-200 text-slate-300 hover:text-white">
                <i data-lucide="file-plus" class="w-4 h-4"></i>
                <span class="text-xs font-medium">New</span>
            </button>
            <button onclick="saveDrawing()" class="flex items-center gap-x-2 px-4 py-2 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 transition-colors duration-200 text-slate-300 hover:text-white">
                <i data-lucide="save" class="w-4 h-4"></i>
                <span class="text-xs font-medium">Save</span>
            </button>
            <div class="w-px h-6 bg-slate-700/50"></div>
            <button onclick="exportSVG()" class="flex items-center gap-x-2 px-4 py-2 rounded-lg bg-blue-600/10 hover:bg-blue-600/20 transition-colors duration-200 text-blue-400 hover:text-blue-300">
                <i data-lucide="file-image" class="w-4 h-4"></i>
                <span class="text-xs font-medium">SVG</span>
            </button>
            <button onclick="exportPDF()" class="flex items-center gap-x-2 px-4 py-2 rounded-lg bg-blue-600/10 hover:bg-blue-600/20 transition-colors duration-200 text-blue-400 hover:text-blue-300">
                <i data-lucide="file-text" class="w-4 h-4"></i>
                <span class="text-xs font-medium">PDF</span>
            </button>
        </div>
    </nav>
    <div class="flex flex-1 overflow-hidden">
        <div class="w-80 bg-slate-900/30 backdrop-blur border-r border-slate-700/50 p-8 flex flex-col overflow-y-auto space-y-6">
            <div>
                <div class="uppercase text-xs tracking-widest text-slate-400 font-semibold mb-4">Project Info</div>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-slate-400 font-medium block mb-2">Company Logo</label>
                        <label class="block">
                            <div class="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-lg text-xs text-slate-400 hover:border-blue-500 cursor-pointer transition-colors text-center">
                                üì∑ Upload Logo
                            </div>
                            <input type="file" id="logo-upload" accept="image/*" onchange="uploadLogo()" style="display:none;">
                        </label>
                        <div id="logo-preview" class="mt-2 h-12 bg-slate-800/50 border border-slate-700 rounded-lg flex items-center justify-center text-xs text-slate-500"></div>
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 font-medium block mb-2">Drawing Title <span class="text-red-400">*</span></label>
                        <input type="text" id="meta-title" value="BRACKET ASSEMBLY" onchange="validateRequired()" class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 font-medium block mb-2">Drawing Number <span class="text-red-400">*</span></label>
                        <input type="text" id="meta-dwg" value="VD-2026-088" onchange="validateRequired()" class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 font-medium block mb-2">Revision <span class="text-red-400">*</span></label>
                        <input type="text" id="meta-rev" value="C" onchange="validateRequired()" class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 font-medium block mb-2">Material</label>
                        <input type="text" id="meta-material" value="6061-T6 ALUMINUM" class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500">
                    </div>
                </div>
            </div>

            <div class="border-t border-slate-700/30 pt-6">
                <div class="uppercase text-xs tracking-widest text-slate-400 font-semibold mb-4">Drawing Format</div>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-slate-400 font-medium block mb-2">Paper Size</label>
                        <select id="paper-size" onchange="changePaperSize()" class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-slate-100 focus:outline-none focus:border-blue-500">
                            <option value="letter">Letter (8.5 x 11")</option>
                            <option value="tabloid">Tabloid (11 x 17")</option>
                            <option value="A4">A4 (210 x 297mm)</option>
                            <option value="A3">A3 (297 x 420mm)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-xs text-slate-400 font-medium block mb-2">Width</label>
                            <input type="number" id="paper-width" value="820" class="w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-slate-100 focus:outline-none focus:border-blue-500">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 font-medium block mb-2">Height</label>
                            <input type="number" id="paper-height" value="580" class="w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-slate-100 focus:outline-none focus:border-blue-500">
                        </div>
                    </div>
                </div>
            </div>

            <div class="border-t border-slate-700/30 pt-6">
                <div class="uppercase text-xs tracking-widest text-slate-400 font-semibold mb-4">Units & Scale</div>
                <div class="space-y-4">
                    <div>
                        <div class="flex items-center justify-between text-xs mb-3">
                            <span class="text-slate-400 font-medium">Unit System</span>
                            <span id="units-label" class="font-semibold text-blue-400">INCHES</span>
                        </div>
                        <div class="flex bg-slate-800/50 rounded-lg p-1 border border-slate-700">
                            <button onclick="setUnits(0)" id="unit-in" class="flex-1 py-2 text-xs rounded-md font-semibold active bg-blue-600 text-white">INCHES</button>
                            <button onclick="setUnits(1)" id="unit-mm" class="flex-1 py-2 text-xs rounded-md font-semibold text-slate-400 hover:text-slate-100">MM</button>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 font-medium block mb-2">Scale</label>
                        <input type="text" id="meta-scale" value="1:1" class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500">
                    </div>
                </div>
            </div>

            <div class="border-t border-slate-700/30 pt-6">
                <div class="uppercase text-xs tracking-widest text-slate-400 font-semibold mb-4">ASME Dimension Std</div>
                <div class="space-y-3">
                    <div>
                        <label class="text-xs text-slate-400 font-medium block mb-2">Dim Line Width</label>
                        <select id="dim-thickness" class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-slate-100 focus:outline-none focus:border-blue-500">
                            <option value="3">Thin (3px)</option>
                            <option value="4">Light (4px)</option>
                            <option value="6" selected>Standard (6px)</option>
                            <option value="8">Bold (8px)</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 font-medium block mb-2">Text Height</label>
                        <select id="text-height" class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-slate-100 focus:outline-none focus:border-blue-500">
                            <option value="28">Small (28px)</option>
                            <option value="32" selected>Standard (32px)</option>
                            <option value="36">Large (36px)</option>
                            <option value="42">Extra Large (42px)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="border-t border-slate-700/30 pt-6 mt-auto">
                <label class="flex items-center gap-x-3 cursor-pointer mb-6 group">
                    <input type="checkbox" id="asme-check" checked class="w-5 h-5 accent-blue-500 rounded">
                    <div>
                        <div class="font-medium text-sm text-slate-300 group-hover:text-white">ASME Y14.5-2018</div>
                        <div class="text-xs text-slate-500">Compliant</div>
                    </div>
                </label>
                <button onclick="validateDrawing()" class="w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 rounded-lg text-sm font-semibold text-white transition-all duration-200 shadow-lg hover:shadow-xl">VALIDATE</button>
            </div>
        </div>
        <div class="flex-1 flex flex-col bg-slate-950/50">
            <div id="viewer-panel" class="flex-1 flex flex-col items-center justify-center p-12 overflow-auto space-y-8">
                <div id="svg-wrapper" class="relative cursor-grab active:cursor-grabbing">
                    <div id="svg-container" class="viewer-svg"></div>
                </div>
                <div id="title-block" class="title-block w-[820px] grid grid-cols-12 p-8 text-slate-900"></div>
            </div>

            <div id="code-panel" class="flex-1 hidden flex-col p-8 bg-slate-900/50 backdrop-blur overflow-hidden">
                <div class="max-w-6xl mx-auto w-full h-full flex flex-col space-y-4">
                    <div>
                        <h2 class="text-base font-semibold text-slate-100 mb-4">SVG Code</h2>
                        <div class="flex gap-x-3 flex-wrap">
                            <button onclick="validateAndShowErrors()" class="px-4 py-2.5 bg-purple-600/20 hover:bg-purple-600/30 rounded-lg border border-purple-500/50 text-purple-400 text-xs font-medium transition-all duration-200">VALIDATE</button>
                            <button onclick="copyCode()" class="px-4 py-2.5 bg-slate-800/50 hover:bg-slate-700/50 rounded-lg border border-slate-700 text-slate-300 text-xs font-medium transition-all duration-200">COPY SVG</button>
                            <button onclick="copyGrokPrompt()" class="px-4 py-2.5 bg-blue-600/20 hover:bg-blue-600/30 rounded-lg border border-blue-500/50 text-blue-400 text-xs font-medium transition-all duration-200">GROK PROMPT</button>
                            <button onclick="loadFromJSON()" class="px-4 py-2.5 bg-green-600/20 hover:bg-green-600/30 rounded-lg border border-green-500/50 text-green-400 text-xs font-medium transition-all duration-200">LOAD JSON</button>
                        </div>
                    </div>
                    <div id="validation-panel" class="hidden p-4 rounded-lg border border-yellow-500/50 bg-yellow-500/10">
                        <div class="font-semibold text-yellow-400 mb-3 text-sm">Validation Results</div>
                        <div id="validation-output" class="text-xs text-yellow-200 space-y-1"></div>
                    </div>
                    <textarea id="code-text" placeholder="Paste SVG code here..." class="flex-1 bg-slate-950/50 border border-slate-700 font-mono text-xs p-6 text-emerald-300 rounded-lg resize-none focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"></textarea>
                </div>
            </div>

            <div id="three-panel" class="flex-1 hidden bg-slate-950 relative rounded-lg m-8">
                <canvas id="three-canvas" class="w-full h-full rounded-lg"></canvas>
            </div>

            <div id="rules-panel" class="flex-1 hidden flex-col p-8 bg-slate-900/50 backdrop-blur overflow-y-auto">
                <div class="max-w-4xl mx-auto w-full space-y-8">
                    <div>
                        <h2 class="text-lg font-bold text-white mb-6">Design Standards</h2>
                        <div class="space-y-3">
                            <h3 class="text-sm font-semibold text-blue-400 uppercase tracking-wider">ASME Y14.5-2018 Rules</h3>
                            <div class="constraint-item">
                                <div class="font-medium text-slate-100">Horizontal/Vertical dimensions</div>
                                <div class="text-xs text-slate-400 mt-2">Place dimensions parallel to object edges or aligned at 90¬∞</div>
                            </div>
                            <div class="constraint-item">
                                <div class="font-medium text-slate-100">Dimension lines must be dashed</div>
                                <div class="text-xs text-slate-400 mt-2">Use stroke-dasharray="12 8" for proper dimensioning</div>
                            </div>
                            <div class="constraint-item">
                                <div class="font-medium text-slate-100">Text must be readable and bold</div>
                                <div class="text-xs text-slate-400 mt-2">Minimum font-size: 32px, font-weight: 600</div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-sm font-semibold text-emerald-400 uppercase tracking-wider mb-4">Quick Templates</h3>
                        <div class="template-grid">
                            <button onclick="insertTemplate('simple_rect')" class="template-button">
                                <div class="text-xs font-semibold text-slate-100">Simple Rect</div>
                                <div class="text-[10px] text-slate-500 mt-1">Basic rectangle</div>
                            </button>
                            <button onclick="insertTemplate('two_holes')" class="template-button">
                                <div class="text-xs font-semibold text-slate-100">Two Holes</div>
                                <div class="text-[10px] text-slate-500 mt-1">Plate pattern</div>
                            </button>
                            <button onclick="insertTemplate('bracket')" class="template-button">
                                <div class="text-xs font-semibold text-slate-100">L-Bracket</div>
                                <div class="text-[10px] text-slate-500 mt-1">Angular piece</div>
                            </button>
                            <button onclick="insertTemplate('hole_pattern')" class="template-button">
                                <div class="text-xs font-semibold text-slate-100">Hole Pattern</div>
                                <div class="text-[10px] text-slate-500 mt-1">4-hole array</div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="h-10 bg-slate-900/50 backdrop-blur border-t border-slate-700/50 px-8 flex items-center justify-between text-[11px] text-slate-500 font-mono">
        <div class="flex-1">vibedraft v0.1 ‚Ä¢ ASME Y14.5 ‚Ä¢ SVG Editor</div>
        <div class="text-cyan-400">Ready for Grok</div>
    </div>
    <script>
        tailwind.config = { content: [] };

        let currentSVG = '', currentUnits = 'inches', zoomLevel = 1, isDragging = false, startPanX = 0, startPanY = 0, currentLogo = '';

        const PaperSizes = {
            letter: { width: 816, height: 1056, name: "Letter (8.5 x 11\")" },
            tabloid: { width: 1056, height: 816, name: "Tabloid (11 x 17\")" },
            A4: { width: 794, height: 1123, name: "A4 (210 x 297mm)" },
            A3: { width: 1123, height: 1587, name: "A3 (297 x 420mm)" },
            custom: { width: 820, height: 580, name: "Custom" }
        };

        function uploadLogo() {
            const input = document.getElementById('logo-upload');
            if (!input.files[0]) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                currentLogo = e.target.result;
                const preview = document.getElementById('logo-preview');
                preview.innerHTML = `<img src="${currentLogo}" style="max-height: 100%; max-width: 100%; object-fit: contain;">`;
            };
            reader.readAsDataURL(input.files[0]);
        }

        function validateRequired() {
            const title = document.getElementById('meta-title').value.trim();
            const dwg = document.getElementById('meta-dwg').value.trim();
            const rev = document.getElementById('meta-rev').value.trim();
            const missing = [];
            if (!title) missing.push('Drawing Title');
            if (!dwg) missing.push('Drawing Number');
            if (!rev) missing.push('Revision');
            if (missing.length > 0) {
                alert(`‚ö†Ô∏è Missing required fields:\n‚Ä¢ ${missing.join('\n‚Ä¢ ')}\n\nThese are needed for professional drawings.`);
                return false;
            }
            return true;
        }

        function validateBeforeExport() {
            if (!validateRequired()) return false;
            const title = document.getElementById('meta-title').value.trim();
            if (title === '') {
                alert('‚ö†Ô∏è Drawing Title is required for PDF export');
                return false;
            }
            if (!currentSVG) {
                alert('‚ö†Ô∏è No drawing found. Please create or load a drawing first.');
                return false;
            }
            return true;
        }

        function changePaperSize() {
            const size = document.getElementById('paper-size').value;
            if (PaperSizes[size]) {
                document.getElementById('paper-width').value = PaperSizes[size].width;
                document.getElementById('paper-height').value = PaperSizes[size].height;
            }
        }

        function getASMESettings() {
            return {
                dimThickness: parseInt(document.getElementById('dim-thickness').value),
                textHeight: parseInt(document.getElementById('text-height').value)
            };
        }

        const SVGValidator = {errors: [], validate: function(s) {this.errors = []; try {const p = new DOMParser(), d = p.parseFromString(s, 'text/xml'); if (d.getElementsByTagName('parsererror').length > 0) {this.errors.push('Parse error'); return false;} return !!d.querySelector('svg');} catch(e) {this.errors.push('Error: ' + e.message); return false;}}};

        const Templates = {
            simple_rect: () => {const set = getASMESettings(); return `<svg width="820" height="580" viewBox="0 0 820 580" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="110" y="90" width="600" height="400" rx="20" fill="#f8fafc" stroke="#1e2937" stroke-width="28"/><line x1="80" y1="90" x2="80" y2="490" stroke="#64748b" stroke-width="${set.dimThickness}" stroke-dasharray="12 8"/><line x1="710" y1="90" x2="710" y2="490" stroke="#64748b" stroke-width="${set.dimThickness}" stroke-dasharray="12 8"/><text x="50" y="300" font-family="sans-serif" font-size="${set.textHeight}" fill="#1e2937" text-anchor="middle" font-weight="600" transform="rotate(-90 50 300)">4.50"</text><line x1="110" y1="510" x2="710" y2="510" stroke="#64748b" stroke-width="${set.dimThickness}" stroke-dasharray="12 8"/><text x="410" y="545" font-family="sans-serif" font-size="${set.textHeight + 10}" fill="#1e2937" text-anchor="middle" font-weight="600">6.00"</text></svg>`;},
            two_holes: () => {const set = getASMESettings(); return `<svg width="820" height="580" viewBox="0 0 820 580" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="110" y="90" width="600" height="400" rx="20" fill="#f8fafc" stroke="#1e2937" stroke-width="28"/><circle cx="310" cy="290" r="55" fill="none" stroke="#1e2937" stroke-width="16"/><circle cx="510" cy="290" r="55" fill="none" stroke="#1e2937" stroke-width="16"/><line x1="210" y1="270" x2="610" y2="270" stroke="#64748b" stroke-width="${set.dimThickness}" stroke-dasharray="12 8"/><text x="410" y="250" font-family="sans-serif" font-size="${set.textHeight + 10}" fill="#1e2937" text-anchor="middle" font-weight="600">8.00"</text><text x="310" y="380" font-family="sans-serif" font-size="${set.textHeight}" fill="#1e2937" text-anchor="middle" font-weight="600">√ò1.10"</text><text x="510" y="380" font-family="sans-serif" font-size="${set.textHeight}" fill="#1e2937" text-anchor="middle" font-weight="600">√ò1.10"</text></svg>`;},
            bracket: () => {const set = getASMESettings(); return `<svg width="820" height="580" viewBox="0 0 820 580" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M 150 250 L 150 150 L 450 150 L 450 250 L 300 250 L 300 350 L 150 350 Z" fill="#f8fafc" stroke="#1e2937" stroke-width="24"/><text x="410" y="520" font-family="sans-serif" font-size="${set.textHeight}" fill="#1e2937" text-anchor="middle" font-weight="600">L-BRACKET</text></svg>`;},
            hole_pattern: () => {const set = getASMESettings(); return `<svg width="820" height="580" viewBox="0 0 820 580" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="110" y="90" width="600" height="400" rx="20" fill="#f8fafc" stroke="#1e2937" stroke-width="28"/><circle cx="210" cy="190" r="35" fill="none" stroke="#1e2937" stroke-width="12"/><circle cx="610" cy="190" r="35" fill="none" stroke="#1e2937" stroke-width="12"/><circle cx="210" cy="390" r="35" fill="none" stroke="#1e2937" stroke-width="12"/><circle cx="610" cy="390" r="35" fill="none" stroke="#1e2937" stroke-width="12"/><text x="410" y="520" font-family="sans-serif" font-size="${set.textHeight}" fill="#1e2937" text-anchor="middle" font-weight="600">4-HOLE</text></svg>`;}
        };

        function insertTemplate(n) {if (Templates[n]) {currentSVG = Templates[n](); renderViewer(); switchTab(0);}}
        function renderViewer() {const c = document.getElementById('svg-container'); c.innerHTML = currentSVG; const s = c.querySelector('svg'); if (s) {s.style.width = '820px'; s.style.height = '580px';} renderTitleBlock(); updateCodePanel();}
        function renderTitleBlock() {const t = document.getElementById('title-block'), title = document.getElementById('meta-title').value, dwg = document.getElementById('meta-dwg').value, rev = document.getElementById('meta-rev').value, mat = document.getElementById('meta-material').value, scale = document.getElementById('meta-scale').value; let logoHtml = ''; if (currentLogo) {logoHtml = `<img src="${currentLogo}" style="height: 60px; object-fit: contain;"/>`;}; t.innerHTML = `<div class="col-span-12 flex justify-between items-start border-b border-slate-300 pb-4"><div><div class="flex items-start gap-4"><div>${logoHtml}</div><div><div class="text-3xl font-bold tracking-tight text-slate-900">${title}</div><div class="text-sm text-slate-600 mt-2">${dwg} ‚Ä¢ REV ${rev}</div></div></div></div><div class="text-right"><div class="text-xs text-slate-700 font-medium">${mat}</div><div class="text-xs text-slate-700 font-medium mt-3">${scale}</div></div></div><div class="col-span-12 text-[10px] pt-4 text-slate-600 grid grid-cols-3"><div>DRAWN BY: GROK</div><div class="text-center">DATE: ${new Date().toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'})}</div><div class="text-right">ASME Y14.5</div></div>`;}
        function switchTab(n) {document.querySelectorAll('[id^="tab-"]').forEach(b => b.classList.remove('tab-active')); document.getElementById(`tab-${n}`).classList.add('tab-active'); document.getElementById('viewer-panel').classList.add('hidden'); document.getElementById('code-panel').classList.add('hidden'); document.getElementById('three-panel').classList.add('hidden'); document.getElementById('rules-panel').classList.add('hidden'); if (n === 0) document.getElementById('viewer-panel').classList.remove('hidden'); if (n === 1) {document.getElementById('code-panel').classList.remove('hidden'); updateCodePanel();} if (n === 2) {document.getElementById('three-panel').classList.remove('hidden'); initThreeIfNeeded();} if (n === 3) document.getElementById('rules-panel').classList.remove('hidden');}
        function updateCodePanel() {document.getElementById('code-text').value = currentSVG || '';}
        function initThreeIfNeeded() {if (window.threeInitialized) return; window.threeInitialized = true; const c = document.getElementById('three-canvas'), r = new THREE.WebGLRenderer({canvas: c, antialias: true}); r.setSize(window.innerWidth, window.innerHeight); const s = new THREE.Scene(); s.background = new THREE.Color(0x0a1428); const cam = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 10, 2000); cam.position.set(500, 400, 800); const l = new THREE.DirectionalLight(0xffffff, 1.4); l.position.set(600, 900, 700); s.add(l); s.add(new THREE.AmbientLight(0xaaaaaa)); const b = new THREE.Mesh(new THREE.BoxGeometry(420, 120, 520), new THREE.MeshPhongMaterial({color: 0x64748b})); s.add(b); function anim() {requestAnimationFrame(anim); b.rotation.y += 0.0015; r.render(s, cam);} anim();}
        function setUnits(n) {document.getElementById('unit-in').classList.toggle('active', n === 0); document.getElementById('unit-mm').classList.toggle('active', n === 1); document.getElementById('units-label').textContent = n === 0 ? 'INCHES' : 'MILLIMETERS'; currentUnits = n === 0 ? 'inches' : 'mm';}
        function validateDrawing() {renderTitleBlock(); alert('Metadata validated');}
        function validateAndShowErrors() {const s = document.getElementById('code-text').value, v = SVGValidator.validate(s), p = document.getElementById('validation-panel'), o = document.getElementById('validation-output'); if (v) {o.innerHTML = '<div class="success-badge p-2 rounded">‚úì Valid SVG</div>';} else {let h = '<div class="space-y-1">'; SVGValidator.errors.forEach(e => {h += `<div class="error-badge p-2 rounded text-xs">${e}</div>`;}); h += '</div>'; o.innerHTML = h;} p.classList.remove('hidden');}
        function newDrawing() {if (confirm('Start new drawing?')) {currentSVG = Templates.simple_rect(); renderViewer(); switchTab(0);}}
        function saveDrawing() {if (!validateRequired()) return; const d = {svg: currentSVG, logo: currentLogo, meta: {title: document.getElementById('meta-title').value, dwg: document.getElementById('meta-dwg').value, rev: document.getElementById('meta-rev').value, material: document.getElementById('meta-material').value, scale: document.getElementById('meta-scale').value, paperSize: document.getElementById('paper-size').value, dimThickness: document.getElementById('dim-thickness').value, textHeight: document.getElementById('text-height').value}}; localStorage.setItem('vibedraft_current', JSON.stringify(d)); alert('‚úì Drawing saved to browser');}
        function exportSVG() {if (!validateRequired()) return; const b = new Blob([currentSVG], {type: 'image/svg+xml'}), u = URL.createObjectURL(b), a = document.createElement('a'); a.href = u; a.download = `${document.getElementById('meta-dwg').value || 'vibedraft'}.svg`; a.click();}
        async function exportPDF() {if (!validateBeforeExport()) return; const j = window.jspdf, d = new j.jsPDF('p', 'mm', 'a4'); const c = document.getElementById('svg-wrapper'); const cv = await html2canvas(c, {scale: 3, backgroundColor: '#ffffff'}); const imgWidth = 210; const imgHeight = (cv.height * imgWidth) / cv.width; d.addImage(cv.toDataURL('image/png'), 'PNG', 0, 0, imgWidth, imgHeight); d.save(`${document.getElementById('meta-dwg').value || 'vibedraft'}.pdf`);}
        function copyCode() {if (!currentSVG) {alert('‚ö†Ô∏è No drawing to copy'); return;} navigator.clipboard.writeText(currentSVG); alert('‚úì SVG copied to clipboard');}
        function copyGrokPrompt() {if (!validateRequired()) return; const set = getASMESettings(); const dims = document.getElementById('dim-thickness').value; const p = `vibedraft v0.1 Drawing\nPaper: ${document.getElementById('paper-size').value}\nDim Lines: ${dims}px thickness\nText: ${set.textHeight}px height\nUnits: ${currentUnits}\n\nASME Y14.5-2018 Compliance Requested\n\n\`\`\`svg\n${currentSVG}\n\`\`\`\n\nImprove with proper dimensioning, GD&T controls, and better layout. Return ONLY the SVG code.`; navigator.clipboard.writeText(p); alert('‚úì Grok prompt copied with ASME settings');}
        function loadFromJSON() {const j = prompt('Paste JSON data:'); if (!j) return; try {const d = JSON.parse(j); if (d.svg) {currentSVG = d.svg; if (d.logo) {currentLogo = d.logo; const preview = document.getElementById('logo-preview'); if (currentLogo) preview.innerHTML = `<img src="${currentLogo}" style="max-height: 100%; max-width: 100%; object-fit: contain;">`;}; if (d.meta) {document.getElementById('meta-title').value = d.meta.title || ''; document.getElementById('meta-dwg').value = d.meta.dwg || ''; document.getElementById('meta-rev').value = d.meta.rev || ''; document.getElementById('meta-material').value = d.meta.material || ''; document.getElementById('meta-scale').value = d.meta.scale || '1:1'; if (d.meta.paperSize) {document.getElementById('paper-size').value = d.meta.paperSize; changePaperSize();} if (d.meta.dimThickness) document.getElementById('dim-thickness').value = d.meta.dimThickness; if (d.meta.textHeight) document.getElementById('text-height').value = d.meta.textHeight;} renderViewer(); switchTab(0);}} catch(e) {alert('‚ùå Invalid JSON format');}}
        function initializeApp() {lucide.createIcons(); currentSVG = Templates.two_holes(); renderViewer(); switchTab(0); setUnits(0); const w = document.getElementById('svg-wrapper'); w.addEventListener('wheel', e => {e.preventDefault(); zoomLevel += e.deltaY * -0.001; zoomLevel = Math.max(0.5, Math.min(3, zoomLevel)); w.style.transform = `scale(${zoomLevel})`;}); w.addEventListener('mousedown', e => {if (e.button === 0) {isDragging = true; startPanX = e.clientX; startPanY = e.clientY;}}); window.addEventListener('mousemove', e => {if (!isDragging) return; const dx = e.clientX - startPanX, dy = e.clientY - startPanY; w.style.transform = `translate(${dx}px, ${dy}px) scale(${zoomLevel})`;}); window.addEventListener('mouseup', () => isDragging = false); const saved = localStorage.getItem('vibedraft_current'); if (saved) {try {const d = JSON.parse(saved); currentSVG = d.svg; if (d.logo) {currentLogo = d.logo; const preview = document.getElementById('logo-preview'); if (currentLogo) preview.innerHTML = `<img src="${currentLogo}" style="max-height: 100%; max-width: 100%; object-fit: contain;">`;}; if (d.meta) {document.getElementById('meta-title').value = d.meta.title; document.getElementById('meta-dwg').value = d.meta.dwg; document.getElementById('meta-rev').value = d.meta.rev; document.getElementById('meta-material').value = d.meta.material; document.getElementById('meta-scale').value = d.meta.scale; if (d.meta.paperSize) {document.getElementById('paper-size').value = d.meta.paperSize; changePaperSize();} if (d.meta.dimThickness) document.getElementById('dim-thickness').value = d.meta.dimThickness; if (d.meta.textHeight) document.getElementById('text-height').value = d.meta.textHeight;} renderViewer();} catch(e) {}}}
        window.onload = initializeApp;
    </script>
</body>
</html>
