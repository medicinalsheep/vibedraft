<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vibedraft</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600&display=swap');
        .tail-container { font-family: 'Inter', system-ui, sans-serif; }
        .logo-font { font-family: 'Space Grotesk', sans-serif; }
        .viewer-svg { background: white; box-shadow: 0 25px 60px -15px rgb(0 0 0 / 0.5); border: 12px solid #1e2937; max-height: 78vh; }
        .title-block { background: #f8fafc; border: 3px solid #1e2937; font-size: 11px; line-height: 1.05; box-shadow: 0 10px 30px -10px rgb(0 0 0 / 0.3); }
        .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; font-weight: 600; }
        .error-badge { background: #dc2626; color: #fee2e2; }
        .success-badge { background: #059669; color: #d1fae5; }
        .constraint-item { background: #1e293b; border: 1px solid #334155; border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 0.5rem; }
        .template-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 0.5rem; }
        .template-button { background: #1e293b; border: 1px solid #334155; border-radius: 0.5rem; padding: 0.75rem; cursor: pointer; transition: all 0.2s; }
        .template-button:hover { background: #334155; border-color: #3b82f6; }
    </style>
</head>
<body class="tail-container bg-zinc-950 text-zinc-200 overflow-hidden h-screen flex flex-col">
    <nav class="bg-zinc-900 border-b border-zinc-800 px-8 py-4 flex items-center justify-between">
        <div class="flex items-center gap-x-12">
            <div class="flex items-center gap-x-3">
                <div class="w-9 h-9 bg-gradient-to-br from-blue-600 to-blue-500 rounded-2xl flex items-center justify-center text-white font-bold logo-font text-2xl">VD</div>
                <div>
                    <span class="logo-font text-3xl font-semibold tracking-[-2px]">vibedraft</span>
                    <span class="ml-2 text-xs font-medium text-emerald-400">v0.1</span>
                </div>
            </div>
            <div class="flex gap-x-8 text-sm font-medium">
                <button onclick="switchTab(0)" id="tab-0" class="tab-active px-6 py-2">VIEWER</button>
                <button onclick="switchTab(1)" id="tab-1" class="px-6 py-2 hover:text-white transition">CODE</button>
                <button onclick="switchTab(2)" id="tab-2" class="px-6 py-2 hover:text-white transition">3D</button>
                <button onclick="switchTab(3)" id="tab-3" class="px-6 py-2 hover:text-white transition">RULES</button>
            </div>
        </div>
        <div class="flex items-center gap-x-6">
            <button onclick="newDrawing()" class="flex items-center gap-x-2 px-5 py-2.5 hover:bg-zinc-800 rounded transition"><i data-lucide="file-plus" class="w-5 h-5"></i><span class="text-sm">New</span></button>
            <button onclick="saveDrawing()" class="flex items-center gap-x-2 px-5 py-2.5 hover:bg-zinc-800 rounded transition"><i data-lucide="save" class="w-5 h-5"></i><span class="text-sm">Save</span></button>
            <div class="h-6 w-px bg-zinc-700"></div>
            <button onclick="exportSVG()" class="flex items-center gap-x-2 px-5 py-2.5 hover:bg-zinc-800 rounded transition"><i data-lucide="file-image" class="w-5 h-5"></i><span class="text-sm">SVG</span></button>
            <button onclick="exportPDF()" class="flex items-center gap-x-2 px-5 py-2.5 hover:bg-zinc-800 rounded transition"><i data-lucide="file-text" class="w-5 h-5"></i><span class="text-sm">PDF</span></button>
        </div>
    </nav>
    <div class="flex flex-1 overflow-hidden">
        <div class="w-80 bg-zinc-900 border-r border-zinc-800 p-6 flex flex-col overflow-y-auto">
            <div class="uppercase text-xs tracking-widest text-zinc-500 mb-6">PROJECT</div>
            <div class="mb-4"><label class="text-xs text-zinc-400 block mb-2">Title</label><input type="text" id="meta-title" value="BRACKET ASSEMBLY" class="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded text-sm text-zinc-200 focus:outline-none focus:border-blue-500"></div>
            <div class="mb-4"><label class="text-xs text-zinc-400 block mb-2">Drawing Number</label><input type="text" id="meta-dwg" value="VD-2026-088" class="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded text-sm text-zinc-200 focus:outline-none focus:border-blue-500"></div>
            <div class="mb-4"><label class="text-xs text-zinc-400 block mb-2">Revision</label><input type="text" id="meta-rev" value="C" class="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded text-sm text-zinc-200 focus:outline-none focus:border-blue-500"></div>
            <div class="mb-4"><label class="text-xs text-zinc-400 block mb-2">Material</label><input type="text" id="meta-material" value="6061-T6 ALUMINUM" class="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded text-sm text-zinc-200 focus:outline-none focus:border-blue-500"></div>
            <div class="border-t border-zinc-700 my-4 pt-4">
                <div class="uppercase text-xs tracking-widest text-zinc-500 mb-4">UNITS</div>
                <div class="mb-4">
                    <div class="flex items-center justify-between text-xs mb-2"><span class="text-zinc-400">UNITS</span><span id="units-label" class="font-medium">INCHES</span></div>
                    <div class="flex bg-zinc-800 rounded p-1">
                        <button onclick="setUnits(0)" id="unit-in" class="flex-1 py-2 text-xs rounded font-medium active bg-zinc-700">INCHES</button>
                        <button onclick="setUnits(1)" id="unit-mm" class="flex-1 py-2 text-xs rounded font-medium">MM</button>
                    </div>
                </div>
                <div class="mb-4"><label class="text-xs text-zinc-400 block mb-2">Scale</label><input type="text" id="meta-scale" value="1:1" class="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded text-sm text-zinc-200 focus:outline-none focus:border-blue-500"></div>
            </div>
            <div class="mt-auto pt-6 border-t border-zinc-700">
                <label class="flex items-center gap-x-3 cursor-pointer mb-4"><input type="checkbox" id="asme-check" checked class="w-4 h-4 accent-blue-600"><span class="text-sm">ASME Y14.5-2018</span></label>
                <button onclick="validateDrawing()" class="w-full py-2 px-3 bg-blue-600 hover:bg-blue-500 rounded text-sm font-medium">VALIDATE</button>
            </div>
        </div>
        <div class="flex-1 flex flex-col">
            <div id="viewer-panel" class="flex-1 flex flex-col items-center justify-center bg-zinc-950 p-12 overflow-auto">
                <div id="svg-wrapper" class="relative cursor-grab active:cursor-grabbing"><div id="svg-container" class="viewer-svg"></div></div>
                <div id="title-block" class="title-block mt-10 w-[820px] grid grid-cols-12 p-6 text-zinc-900"></div>
            </div>
            <div id="code-panel" class="flex-1 hidden flex-col p-8 bg-zinc-900 overflow-hidden">
                <div class="max-w-6xl mx-auto w-full h-full flex flex-col">
                    <div class="text-lg font-medium mb-4">SVG CODE</div>
                    <div class="flex gap-x-4 mb-4">
                        <button onclick="validateAndShowErrors()" class="px-4 py-2 bg-purple-600 hover:bg-purple-500 rounded text-sm font-medium">VALIDATE</button>
                        <button onclick="copyCode()" class="px-4 py-2 bg-zinc-700 hover:bg-zinc-600 rounded text-sm font-medium">COPY</button>
                        <button onclick="copyGrokPrompt()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-sm font-medium">GROK PROMPT</button>
                        <button onclick="loadFromJSON()" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded text-sm font-medium">LOAD JSON</button>
                    </div>
                    <div id="validation-panel" class="hidden mb-4 p-4 rounded border border-yellow-600/50 bg-yellow-600/10"><div class="font-medium text-yellow-400 mb-2">Results</div><div id="validation-output" class="text-xs text-yellow-200"></div></div>
                    <textarea id="code-text" class="flex-1 bg-black border border-zinc-800 font-mono text-xs p-8 text-emerald-300 rounded resize-none focus:outline-none focus:border-blue-500"></textarea>
                </div>
            </div>
            <div id="three-panel" class="flex-1 hidden bg-[#0a1428] relative"><canvas id="three-canvas" class="w-full h-full"></canvas></div>
            <div id="rules-panel" class="flex-1 hidden flex-col p-8 bg-zinc-900 overflow-y-auto">
                <div class="max-w-4xl mx-auto w-full">
                    <div class="text-lg font-medium mb-6">DESIGN RULES</div>
                    <div class="mb-8">
                        <h3 class="text-base font-medium mb-4 text-blue-400">ASME Y14.5-2018</h3>
                        <div class="space-y-3">
                            <div class="constraint-item"><div class="font-medium text-sm">Horizontal/Vertical dimensions</div><div class="text-xs text-zinc-400 mt-1">Parallel to object edges or aligned at 90 degrees</div></div>
                            <div class="constraint-item"><div class="font-medium text-sm">Dimension lines dashed</div><div class="text-xs text-zinc-400 mt-1">stroke-dasharray="12 8"</div></div>
                            <div class="constraint-item"><div class="font-medium text-sm">Text readable and bold</div><div class="text-xs text-zinc-400 mt-1">Min font-size: 32px, font-weight: 600</div></div>
                        </div>
                    </div>
                    <div class="mb-8">
                        <h3 class="text-base font-medium mb-4 text-emerald-400">Templates</h3>
                        <div class="template-grid">
                            <button onclick="insertTemplate('simple_rect')" class="template-button text-xs font-medium">Simple Rect</button>
                            <button onclick="insertTemplate('two_holes')" class="template-button text-xs font-medium">Two Holes</button>
                            <button onclick="insertTemplate('bracket')" class="template-button text-xs font-medium">L-Bracket</button>
                            <button onclick="insertTemplate('hole_pattern')" class="template-button text-xs font-medium">Hole Pattern</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="h-9 bg-zinc-900 border-t border-zinc-800 px-8 flex items-center text-[10px] text-zinc-500 font-mono"><div class="flex-1">vibedraft v0.1</div><div class="text-emerald-400">Grok ready</div></div>
    <script>
        tailwind.config = { content: [] };
        let currentSVG = '', currentUnits = 'inches', zoomLevel = 1, isDragging = false, startPanX = 0, startPanY = 0;
        const SVGValidator = {errors: [], validate: function(s) {this.errors = []; try {const p = new DOMParser(), d = p.parseFromString(s, 'text/xml'); if (d.getElementsByTagName('parsererror').length > 0) {this.errors.push('Parse error'); return false;} return !!d.querySelector('svg');} catch(e) {this.errors.push('Error: ' + e.message); return false;}}};
        const Templates = {
            simple_rect: () => `<svg width="820" height="580" viewBox="0 0 820 580" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="110" y="90" width="600" height="400" rx="20" fill="#f8fafc" stroke="#1e2937" stroke-width="28"/><line x1="80" y1="90" x2="80" y2="490" stroke="#64748b" stroke-width="6" stroke-dasharray="12 8"/><line x1="710" y1="90" x2="710" y2="490" stroke="#64748b" stroke-width="6" stroke-dasharray="12 8"/><text x="50" y="300" font-family="sans-serif" font-size="32" fill="#1e2937" text-anchor="middle" font-weight="600" transform="rotate(-90 50 300)">4.50"</text><line x1="110" y1="510" x2="710" y2="510" stroke="#64748b" stroke-width="6" stroke-dasharray="12 8"/><text x="410" y="545" font-family="sans-serif" font-size="42" fill="#1e2937" text-anchor="middle" font-weight="600">6.00"</text></svg>`,
            two_holes: () => `<svg width="820" height="580" viewBox="0 0 820 580" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="110" y="90" width="600" height="400" rx="20" fill="#f8fafc" stroke="#1e2937" stroke-width="28"/><circle cx="310" cy="290" r="55" fill="none" stroke="#1e2937" stroke-width="16"/><circle cx="510" cy="290" r="55" fill="none" stroke="#1e2937" stroke-width="16"/><line x1="210" y1="270" x2="610" y2="270" stroke="#64748b" stroke-width="6" stroke-dasharray="12 8"/><text x="410" y="250" font-family="sans-serif" font-size="42" fill="#1e2937" text-anchor="middle" font-weight="600">8.00"</text><text x="310" y="380" font-family="sans-serif" font-size="32" fill="#1e2937" text-anchor="middle" font-weight="600">Ø1.10"</text><text x="510" y="380" font-family="sans-serif" font-size="32" fill="#1e2937" text-anchor="middle" font-weight="600">Ø1.10"</text></svg>`,
            bracket: () => `<svg width="820" height="580" viewBox="0 0 820 580" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M 150 250 L 150 150 L 450 150 L 450 250 L 300 250 L 300 350 L 150 350 Z" fill="#f8fafc" stroke="#1e2937" stroke-width="24"/><text x="410" y="520" font-family="sans-serif" font-size="32" fill="#1e2937" text-anchor="middle" font-weight="600">L-BRACKET</text></svg>`,
            hole_pattern: () => `<svg width="820" height="580" viewBox="0 0 820 580" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="110" y="90" width="600" height="400" rx="20" fill="#f8fafc" stroke="#1e2937" stroke-width="28"/><circle cx="210" cy="190" r="35" fill="none" stroke="#1e2937" stroke-width="12"/><circle cx="610" cy="190" r="35" fill="none" stroke="#1e2937" stroke-width="12"/><circle cx="210" cy="390" r="35" fill="none" stroke="#1e2937" stroke-width="12"/><circle cx="610" cy="390" r="35" fill="none" stroke="#1e2937" stroke-width="12"/><text x="410" y="520" font-family="sans-serif" font-size="32" fill="#1e2937" text-anchor="middle" font-weight="600">4-HOLE</text></svg>`
        };
        function insertTemplate(n) {if (Templates[n]) {currentSVG = Templates[n](); renderViewer(); switchTab(0);}}
        function renderViewer() {const c = document.getElementById('svg-container'); c.innerHTML = currentSVG; const s = c.querySelector('svg'); if (s) {s.style.width = '820px'; s.style.height = '580px';} renderTitleBlock(); updateCodePanel();}
        function renderTitleBlock() {const t = document.getElementById('title-block'), title = document.getElementById('meta-title').value, dwg = document.getElementById('meta-dwg').value, rev = document.getElementById('meta-rev').value, mat = document.getElementById('meta-material').value, scale = document.getElementById('meta-scale').value; t.innerHTML = `<div class="col-span-12 flex justify-between items-start border-b border-zinc-900 pb-4"><div><div class="text-3xl font-semibold tracking-tighter text-zinc-900">${title}</div><div class="text-sm text-zinc-500 mt-1">${dwg} • REV ${rev}</div></div><div class="text-right"><div class="text-xs leading-none">${mat}</div><div class="text-xs mt-4">${scale}</div></div></div><div class="col-span-12 text-[10px] pt-4 text-zinc-600 grid grid-cols-3"><div>DRAWN BY: GROK</div><div class="text-center">DATE: ${new Date().toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'})}</div><div class="text-right">ASME Y14.5</div></div>`;}
        function switchTab(n) {document.querySelectorAll('[id^="tab-"]').forEach(b => b.classList.remove('tab-active')); document.getElementById(`tab-${n}`).classList.add('tab-active'); document.getElementById('viewer-panel').classList.add('hidden'); document.getElementById('code-panel').classList.add('hidden'); document.getElementById('three-panel').classList.add('hidden'); document.getElementById('rules-panel').classList.add('hidden'); if (n === 0) document.getElementById('viewer-panel').classList.remove('hidden'); if (n === 1) {document.getElementById('code-panel').classList.remove('hidden'); updateCodePanel();} if (n === 2) {document.getElementById('three-panel').classList.remove('hidden'); initThreeIfNeeded();} if (n === 3) document.getElementById('rules-panel').classList.remove('hidden');}
        function updateCodePanel() {document.getElementById('code-text').value = currentSVG || '';}
        function initThreeIfNeeded() {if (window.threeInitialized) return; window.threeInitialized = true; const c = document.getElementById('three-canvas'), r = new THREE.WebGLRenderer({canvas: c, antialias: true}); r.setSize(window.innerWidth, window.innerHeight); const s = new THREE.Scene(); s.background = new THREE.Color(0x0a1428); const cam = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 10, 2000); cam.position.set(500, 400, 800); const l = new THREE.DirectionalLight(0xffffff, 1.4); l.position.set(600, 900, 700); s.add(l); s.add(new THREE.AmbientLight(0xaaaaaa)); const b = new THREE.Mesh(new THREE.BoxGeometry(420, 120, 520), new THREE.MeshPhongMaterial({color: 0x64748b})); s.add(b); function anim() {requestAnimationFrame(anim); b.rotation.y += 0.0015; r.render(s, cam);} anim();}
        function setUnits(n) {document.getElementById('unit-in').classList.toggle('active', n === 0); document.getElementById('unit-mm').classList.toggle('active', n === 1); document.getElementById('units-label').textContent = n === 0 ? 'INCHES' : 'MILLIMETERS'; currentUnits = n === 0 ? 'inches' : 'mm';}
        function validateDrawing() {renderTitleBlock(); alert('Metadata validated');}
        function validateAndShowErrors() {const s = document.getElementById('code-text').value, v = SVGValidator.validate(s), p = document.getElementById('validation-panel'), o = document.getElementById('validation-output'); if (v) {o.innerHTML = '<div class="success-badge p-2 rounded">✓ Valid SVG</div>';} else {let h = '<div class="space-y-1">'; SVGValidator.errors.forEach(e => {h += `<div class="error-badge p-2 rounded text-xs">${e}</div>`;}); h += '</div>'; o.innerHTML = h;} p.classList.remove('hidden');}
        function newDrawing() {if (confirm('Start new drawing?')) {currentSVG = Templates.simple_rect(); renderViewer(); switchTab(0);}}
        function saveDrawing() {const d = {svg: currentSVG, meta: {title: document.getElementById('meta-title').value, dwg: document.getElementById('meta-dwg').value, rev: document.getElementById('meta-rev').value, material: document.getElementById('meta-material').value, scale: document.getElementById('meta-scale').value}}; localStorage.setItem('vibedraft_current', JSON.stringify(d)); alert('Saved');}
        function exportSVG() {const b = new Blob([currentSVG], {type: 'image/svg+xml'}), u = URL.createObjectURL(b), a = document.createElement('a'); a.href = u; a.download = 'vibedraft.svg'; a.click();}
        async function exportPDF() {const j = window.jspdf, d = new j.jsPDF('p', 'mm', 'a4'), c = document.getElementById('svg-wrapper'), cv = await html2canvas(c, {scale: 3}); d.addImage(cv.toDataURL('image/png'), 'PNG', 15, 20, 180, 130); d.save('vibedraft.pdf');}
        function copyCode() {navigator.clipboard.writeText(currentSVG); alert('Copied');}
        function copyGrokPrompt() {const p = `VibeDraft drawing (ASME Y14.5, ${currentUnits}):\n\`\`\`svg\n${currentSVG}\n\`\`\`\nImprove with dimensioning and GD&T. Return ONLY SVG.`; navigator.clipboard.writeText(p); alert('Prompt copied');}
        function loadFromJSON() {const j = prompt('Paste JSON:'); if (!j) return; try {const d = JSON.parse(j); if (d.svg) {currentSVG = d.svg; if (d.meta) {document.getElementById('meta-title').value = d.meta.title || ''; document.getElementById('meta-dwg').value = d.meta.dwg || ''; document.getElementById('meta-rev').value = d.meta.rev || ''; document.getElementById('meta-material').value = d.meta.material || ''; document.getElementById('meta-scale').value = d.meta.scale || '1:1';} renderViewer(); switchTab(0);}} catch(e) {alert('Invalid JSON');}}
        function initializeApp() {lucide.createIcons(); currentSVG = Templates.two_holes(); renderViewer(); switchTab(0); setUnits(0); const w = document.getElementById('svg-wrapper'); w.addEventListener('wheel', e => {e.preventDefault(); zoomLevel += e.deltaY * -0.001; zoomLevel = Math.max(0.5, Math.min(3, zoomLevel)); w.style.transform = `scale(${zoomLevel})`;}); w.addEventListener('mousedown', e => {if (e.button === 0) {isDragging = true; startPanX = e.clientX; startPanY = e.clientY;}}); window.addEventListener('mousemove', e => {if (!isDragging) return; const dx = e.clientX - startPanX, dy = e.clientY - startPanY; w.style.transform = `translate(${dx}px, ${dy}px) scale(${zoomLevel})`;}); window.addEventListener('mouseup', () => isDragging = false); const saved = localStorage.getItem('vibedraft_current'); if (saved) {try {const d = JSON.parse(saved); currentSVG = d.svg; if (d.meta) {document.getElementById('meta-title').value = d.meta.title; document.getElementById('meta-dwg').value = d.meta.dwg; document.getElementById('meta-rev').value = d.meta.rev; document.getElementById('meta-material').value = d.meta.material; document.getElementById('meta-scale').value = d.meta.scale;} renderViewer();} catch(e) {}}}
        window.onload = initializeApp;
    </script>
</body>
</html>
